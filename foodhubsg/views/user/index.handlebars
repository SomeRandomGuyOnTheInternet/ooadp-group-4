{{> _msg }}
<div id="colorlib-container">
	<div class="container">
		{{#ifCond numOfDays '>=' 4}}
			<div class="row">
				<div class="col-md-6">
					<div class="box1" style="min-height: 432px;">
						<div class="row row-pb-md">
							<div class="col-md-12">
								<div class="blog-entry">
									<div class="blog-img">
										<h3 class="font_color"><b class="center_subtitle">Summary of your food history</b></h3>
										<hr>
										<h4>You consumed an average of 2500 kcal daily over the 6 days you've entered food into your food journal, which is within
										the daily recommended amount, so keep following your current diet. </h4>
									</div>
									<u><a href="/user/foodJournal/">Click here to see your food intake in more
											detail </a></u>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-6">
					<div class="box1">
						<div class="row row-pb-md">
							<div class="col-md-12">
								<div class="blog-entry">
									<div class="blog-img">
										<h3 class="font_color"><b class="center_subtitle">Graph of Food History</b></h3>
										<hr>
										<canvas id="foodHistoryChart" width="400" height="255"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		{{else}}
			<div class="box1">
				<div class="row row-pb-md">
					<div class="col-md-12">
						<div class="blog-entry">
							<div class="blog-img">
								<h3 class="font_color"><b class="center_subtitle">Summary of your food history</b></h3>
								<hr>
								<h4>You have not added enough food to generate a summary. Keep adding more food!</h4>
							</div>
						</div>
					</div>
				</div>
			</div>
		{{/ifCond}}

		<div class="box1">
			<div class="row row-pb-md">
				<div class="col-md-12">
					<h3 class="font_color"><b class="center_subtitle">Recommended food vendors near you</b></h3>
					<hr>
				</div>

				{{#if user.location}}
				<div class="col-md-12">
					<h4 id="current_location">Current Location: <b class="center_subtitle">{{user.location}}</b></h4>
				</div>

					{{#each shops}}
					<div class="col-md-6 recommended-shops">
						<div class="blog-entry">
							<div class="blog-img">
								<a class="action" href="/user/shops/{{this.id}}"><img src="{{this.imageLocation}}" class="img-responsive" alt="Image of shop"></a>
							</div>
							<div class="desc">
								<p class="meta">
									<b class="vendors"><b>{{this.name}}</b></b><br>
									<span class="food_location"><b>{{ this.address }}</b></span><br>
									<span class="food_rating">Rating: <b class="recommended-{{ this.isRecommended }}">{{ this.rating }}</b></span><br>
								</p>
							</div>
						</div>
					</div>
					{{else}}
					<div class="col-md-12">
						<h3 id="current_location"><b class="center_subtitle">There are no recommended shops near you</b></h4>
					</div>
					{{/each}}

				{{else}}
				<div class="col-md-12">
					<h4 id="current_location">We could not detect your current location</b></h4>
				</div>
				{{/if}}

			</div>
		</div> 

	</div>
</div>

<script>
	var foodHistoryChart = document.getElementById('foodHistoryChart');
	var foodItems = {{{ json foodItems }}};
	var labels = [], data = [];

	for (var [key] of Object.entries(foodItems)) {
		labels.push(key);
		data.push(parseInt(foodItems[key].dailyCalories));
	}

	var foodHistoryChart = new Chart(foodHistoryChart, {
		type: 'line',
		data: {
			labels: labels,
			datasets: [{
				data: data,
				label: 'Calories (kcal)',
				backgroundColor: [
					'rgba(255, 99, 132, 0)',
				],
				borderColor: [
					'rgba(76, 187, 23, 0.9)',
				],
				borderWidth: 1,
			}]
		},
		options: {
			responsive: true,
			title: {
				display: false,
			},
			scales: {
				yAxes: [{
					scaleLabel: {
						display: true,
						labelString: 'Calories (kcal)'
					},
					ticks: {
						beginAtZero: true
					}
				}],
				xAxes: [{
					scaleLabel: {
						display: true,
						labelString: 'Dates'
					}
				}],
			},
		},
	});

	{{!-- var foodHistoryChart = document.getElementById('foodHistoryChart');
	var foodItems = {{{ json foodItems }}};
	var labels = [], data = [];

	for (var [key] of Object.entries(foodItems)) {
		labels.push(key);
		data.push(parseInt(foodItems[key].dailyCalories));
	}
	
	var config = {
		type: 'line',
		data: {
			labels: labels,
			datasets: [{
				data: data,
				label: 'Calories (kcal)',
				backgroundColor: [
					'rgba(255, 99, 132, 0)',
				],
				borderColor: [
					'rgba(76, 187, 23, 0.9)',
				],
				borderWidth: 1,
			}]
		},
		options: {
			responsive: true,
			title: {
				display: false,
			},
			scales: {
				yAxes: [{
					scaleLabel: {
						display: true,
						labelString: 'Calories (kcal)'
					}
				}],
				xAxes: [{
					scaleLabel: {
						display: true,
						labelString: 'Dates'
					}
				}],
			},
			horizontalLine: [{
				y: 2000,
				style: "rgba(255, 0, 0, .4)",
				text: "Ideal Calorie Intake"
			}],
		},
	};

	if (chartInstance.options.horizontalLine) {
		for (index = 0; index < chartInstance.options.horizontalLine.length; index++) {
			line = chartInstance.options.horizontalLine[index];

			if (!line.style) {
				style = "rgba(169,169,169, .6)";
			} else {
				style = line.style;
			}

			if (line.y) {
				yValue = yScale.getPixelForValue(line.y);
			} else {
				yValue = 0;
			}

			foodHistoryChart.lineWidth = 3;

			if (yValue) {
				foodHistoryChart.beginPath();
				foodHistoryChart.moveTo(0, yValue);
				foodHistoryChart.lineTo(canvas.width, yValue);
				foodHistoryChart.strokeStyle = style;
				foodHistoryChart.stroke();
			}

			if (line.text) {
				foodHistoryChart.fillStyle = style;
				foodHistoryChart.fillText(line.text, 0, yValue + foodHistoryChart.lineWidth);
			}
		}
	};
                
	Chart.pluginService.register(horizonalLinePlugin);

	var myChart = new Chart(foodHistoryChart); --}}
</script>