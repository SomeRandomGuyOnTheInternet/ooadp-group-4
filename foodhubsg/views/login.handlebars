<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCg3Y-44lgOHZmGOV9TXTDxJ2vb2e2R_Cg" type="text/javascript"></script>

<style>
	body {
		background-image: url("images/green-background.png");
	}
</style>

<div>
	<div class="row">
		<div class="col-md-12" style="overflow-y: hidden; margin-left: 2.5em;">
			<div class="col-md-8">
				<div class="align-items-center" id="welcome-msg">
					<div class="container">
						<h2 class="welcome-header">Welcome to a healthier you.</h2>
						<p class="welcome-body">We have everything you need to get your diet in control,
							from meal journals to personalised diet plans.</p>
					</div>
				</div>
			</div>

			<div class="col-md-4" id="form-input">
				<div class="center-block">
					<div class="text-center auth-brand">
						<img src="images/healthhub-logo.png" id="SN-Logo" width="100" height="95">
						<h1><b>FoodHub.SG</b></h1>
					</div>

					<form method="post">
						<div class="row">
							<div class="col-md-8 offset-md-2">

								<div class="row form-group">
									<h4>Sign into your account</h4>
								</div>

								<div class="row form-group">
									<input type="email" name="email" id="email" class="form-control"
										placeholder="Email Address" required>
								</div>

								<div class="row form-group">
									<input type="password" name="password" id="password" class="form-control"
										placeholder="Password" required>
								</div>

								<div class="row form-group" style="display: none;">
									<input name="location" id="location" class="form-control">
								</div>

								<div class="row form-group" style="display: none;">
									<input name="latitude" id="latitude" class="form-control">
								</div>

								<div class="row form-group" style="display: none;">
									<input name="longitude" id="longitude" class="form-control">
								</div>

								<div class="flash-div">
								{{#if error}}
									<div class="row form-group">
										<div class="col-md-12 row-flash">
											<div class="col-md-12" style="padding: 0;">
												<div class="flash error">
													<div>
														<i class="fas fa-exclamation-triangle"></i>
														&nbsp {{error}}
														<span class="pull-right"><i class="fas fa-times" onclick="hideMessage()"></i></span>
													</div>
												</div>
											</div>
										</div>
									</div>
								{{/if}}
								</div>

								<div class="row form-group">
									<div class="form-group" id="login-button">
										<input type="submit" value="Log In" class="btn btn-success" id="submit-button" data-toggle="tooltip" data-placement="left" title="Please wait while we determine your location"
											style="width:135px;" disabled>
									</div>
								</div>

								<div class="row form-group">
									<p id="new-acc"><a href="/register">Create a new account</a>
									</p>
								</div>

							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

{{!-- below are common locations to simulate geolocation and check the city names --}}

{{!-- Nanyang Poly = latlng = new google.maps.LatLng(1.380096, 103.848895);
Sengkang = latlng = new google.maps.LatLng(1.393593, chr);
Waterway Point (Punggol) = latlng = new google.maps.LatLng(1.407009, 103.902213); --}}

<script>
	const locationInput = document.querySelector("#location");
	const latitudeInput = document.querySelector("#latitude");
	const longitudeInput = document.querySelector("#longitude");
	const submitButton = document.querySelector("#submit-button")
	var currentCity = null;

	function success(position) {
		latitudeInput.setAttribute("value", position.coords.latitude);
		longitudeInput.setAttribute("value", position.coords.longitude);

		latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
		new google.maps.Geocoder().geocode({ 'latLng': latlng }, function (results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				if (results[1]) {
					var c, lc, component;
					for (var r = 0, rl = results.length; r < rl; r += 1) {
						var result = results[r];

						if (!currentCity && result.types[0] === 'neighborhood') {
							for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
								component = result.address_components[c];

								if (component.types[0] === 'neighborhood') {
									currentCity = component.long_name;
									locationInput.setAttribute("value", currentCity);
									submitButton.setAttribute("title", "");
									submitButton.disabled = false;
									break;
								}
							}
						}
					}
				}
			} else {
				error();
			}
		});
	}

	function error() {
		locationInput.setAttribute("value", currentCity);
		submitButton.setAttribute("title", "");
		submitButton.disabled = false;
		alert("We could not determine your location.")
	}

	if (!navigator.geolocation) {
		error();
	} else {
		navigator.geolocation.getCurrentPosition(success, error);
	}
</script>